import{L as ve,k as a,b9 as re,j as ie,Q as x,o as P,b as W,x as n,m as i,p as t,V as Q,q as d,P as fe,y as K,ba as ge,G as y,z as A,ag as ae,$ as _e,a0 as he,w as Ve,aF as Pe,c as q,I as te,F as be,a as we,C as De,D as Se}from"./index.f5778ade.js";import{r as le}from"./validators.d71d6c94.js";import{u as ne}from"./useEmpresaListStore.d0d2b70b.js";import{u as ue}from"./useSuperciasListStore.5ddb8837.js";import{u as de}from"./usePeriodoListStore.0c29807d.js";import{o as ye,a as xe,_ as Ee,b as Ie}from"./ConfirmDuplicatePeriodoDialog.373bb94d.js";import"./reportStore.4330710e.js";import{V as Ne}from"./VSpacer.84b26ffe.js";import{V as E}from"./VBtn.1b313c05.js";import{a as ce}from"./VCard.811866d9.js";import{V as Y}from"./VCardText.21459e26.js";import{V as Ce}from"./VForm.ac9a6e7e.js";import{V as pe}from"./VRow.6bece164.js";import{V as L}from"./VCol.55ec6a95.js";import{V as Z}from"./VSelect.c89c08d3.js";import{V as Oe}from"./VNavigationDrawer.f922ecf3.js";import{d as Re}from"./VTextField.04d3c35c.js";import{V as se}from"./VDivider.6c421e0c.js";import{V as $e}from"./VTable.ee2562d5.js";import{V as Ae}from"./VPagination.fc3c8010.js";import"./index.0d4b9ec4.js";import"./axios.80581068.js";import"./environments.3b606d6b.js";import"./VDialog.d9812f3f.js";import"./scopeId.af0aa75f.js";import"./router.aceff5aa.js";import"./lazy.dd5f2a7f.js";import"./easing.36b781ab.js";import"./location.c31d3587.js";import"./VImg.337ce076.js";import"./forwardRefs.c003b6b8.js";import"./dialog-transition.4a40a600.js";import"./createSimpleFunctional.f5669897.js";import"./group.e7225ded.js";import"./position.1e434685.js";import"./VAvatar.96e9befc.js";import"./form.a8b2966d.js";/* empty css              */import"./VList.6b5daae5.js";import"./index.6e84413a.js";import"./VMenu.4f1471ed.js";import"./VCheckboxBtn.b9d06dc9.js";import"./VSelectionControl.fb242e40.js";import"./VChip.bca106a5.js";import"./ssrBoot.f1fcb362.js";const me=I=>(_e("data-v-fc20c5ad"),I=I(),he(),I),ke={class:"d-flex align-center pa-6 pb-1"},Ue=me(()=>i("h6",{class:"text-h6"}," Nuevo Periodo ",-1)),ze={class:"custom-loader"},Te={class:"pl-2 pr-2"},qe=me(()=>i("span",null,"Cancelar",-1)),Le={__name:"AddNewPeriodo",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(I,{emit:h}){const G=I,N=ne(),F=ue(),B=de(),C=a(!1),f=a(),c=a(""),g=a([]),m=a({title:"Tu Empresa",value:"1717170110",periodosifluc:[]}),b=a([]),v=a([2017,2018,2019,2020,2021,2022,2023,2024,2025]),w=a([]),D=a(""),V=a(1),k=a(1),O=a(1e3);re();const ee=ie(),S=()=>{h("update:isDrawerOpen",!1),ae(()=>{var e,s;(e=f.value)==null||e.reset(),(s=f.value)==null||s.resetValidation()})};x(()=>{N.fetchEmpresas({q:D.value,status:null,plan:null,role:null,perPage:O.value,currentPage:V.value,user:JSON.parse(sessionStorage.getItem("userData")).id,origen:"ifluc"}).then(e=>{const s=e.data.empresas,r=[];s.forEach(z=>{let T={title:z.nombre,value:z.ruc,periodos:z.periodosifluc};r.push(T)}),b.value=r}).catch(e=>{console.error(e)})}),x(()=>{V.value>k.value&&(V.value=k.value)}),x(()=>{B.fetchPeriodos({q:D.value,perPage:O.value,currentPage:V.value,user:JSON.parse(sessionStorage.getItem("userData")).id,origen:"ifluc"}).then(e=>{if(console.log("response periodos: ",e),g.value=e.data.periodos,k.value=e.data.totalPage,Array.isArray(e.data.periodos)){const s=e.data.periodos.map(r=>r.periodo);w.value=v.value.filter(r=>!s.includes(r))}else w.value=[...v.value]}).catch(e=>{console.error(e)})});const R=e=>{console.log("reporteId: ",e),e===0?setTimeout(()=>{let s=JSON.parse(localStorage.getItem("periodonuevo"));R(s)},1e3):H(e)},U=()=>{var e;(e=f.value)==null||e.validate().then(({valid:s})=>{s&&(console.log("empresa: ",m.value),console.log("empresa: ",m.value.value),p.value=!0,localStorage.setItem("empresanueva",JSON.stringify(m.value.value)),h("userData",{periodo:Number(c.value),empresaId:m.value.value,userId:JSON.parse(sessionStorage.getItem("userData")).id}),ae(()=>{setTimeout(()=>{console.log(Number(localStorage.getItem("periodonuevo")));let r=JSON.parse(localStorage.getItem("periodonuevo"));R(r)},2e3)}))})},p=a(!1),$=a(60),M=a(null),j=e=>{e.periodoId>0?(console.log("reporte: ",e),X(e),u(),p.value=!0):console.error("Error al guardar el reporte: Periodo ID inv\xE1lido.")},H=async e=>{console.log("guardarReporteTxt: ",e);try{const s=await ye(),r=await xe(s,e);j(r)}catch(s){console.error("Error al guardar reporte TXT:",s)}},X=e=>{F.addReporteSupercias(e).then(s=>{console.log(s),h("update:isDrawerOpen",!1),ee.replace("/pages/supercias/list")})},u=()=>{p.value=!0,$.value=60,M.value=setInterval(()=>{$.value>0?$.value-=1:o()},1e3)},o=()=>{clearInterval(M),p.value=!1},l=()=>{let e=b.value,s=[];e.forEach(r=>{if((r!=null&&r.value?r==null?void 0:r.value:r)===m.value.value)if(s=r==null?void 0:r.periodos,Array.isArray(s)){const z=s.map(T=>T.periodo);w.value=v.value.filter(T=>!z.includes(T))}else w.value=[...v.value]})},_=e=>{h("update:isDrawerOpen",e)};return(e,s)=>(P(),W(Oe,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":G.isDrawerOpen,"onUpdate:modelValue":_},{default:n(()=>[i("div",ke,[Ue,t(Ne),t(E,{variant:"tonal",color:"default",icon:"",size:"32",class:"rounded",onClick:S},{default:n(()=>[t(Q,{size:"18",icon:"tabler-x"})]),_:1})]),t(d(fe),{options:{wheelPropagation:!1}},{default:n(()=>[t(ce,{flat:""},{default:n(()=>[t(Y,null,{default:n(()=>[t(Ce,{ref_key:"refForm",ref:f,modelValue:d(C),"onUpdate:modelValue":s[2]||(s[2]=r=>K(C)?C.value=r:null),onSubmit:ge(U,["prevent"])},{default:n(()=>[t(pe,null,{default:n(()=>[t(L,{cols:"12"},{default:n(()=>[t(Z,{modelValue:d(m),"onUpdate:modelValue":[s[0]||(s[0]=r=>K(m)?m.value=r:null),l],hint:`${d(m).value}, ${d(m).title}`,items:d(b),rules:[d(le)],"item-title":"title","item-value":"value",label:"Empresas","persistent-hint":"","return-object":"","single-line":"",placeholder:"Seleccione la empresa"},null,8,["modelValue","hint","items","rules"])]),_:1}),t(L,{cols:"12"},{default:n(()=>[t(Z,{modelValue:d(c),"onUpdate:modelValue":s[1]||(s[1]=r=>K(c)?c.value=r:null),label:"Periodo",rules:[d(le)],items:d(w)},null,8,["modelValue","rules","items"])]),_:1}),t(L,{cols:"12"},{default:n(()=>[t(E,{type:"submit",class:"me-4",style:{"font-size":"12px",width:"100%"},loading:d(p),disabled:d(p)||d(c)==""},{loader:n(()=>[i("span",ze,[t(Q,{icon:"tabler-refresh"})]),i("span",Te,"Creando reporte, espere "+y(d($))+" ...",1)]),default:n(()=>[A(" Crear Periodo ")]),_:1},8,["loading","disabled"])]),_:1}),t(L,{cols:"12"},{default:n(()=>[t(E,{type:"reset",variant:"tonal",style:{"font-size":"12px",width:"100%"},color:"secondary",onClick:S,loading:d(p),disabled:d(p)},{loader:n(()=>[qe]),default:n(()=>[A(" Cancelar ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Fe=ve(Le,[["__scopeId","data-v-fc20c5ad"]]);const Be={key:0,class:"text-sm ml-20",style:{color:"red","margin-left":"23px","margin-top":"-20px",position:"absolute"}},Je={class:"me-3",style:{width:"80px"}},Me={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Qe={style:{width:"10rem"}},Ge=i("thead",null,[i("tr",null,[i("th",{scope:"col"}," EMPRESA "),i("th",{scope:"col"}," PERIODO "),i("th",{scope:"col"}," FECHA CREACI\xD3N "),i("th",{scope:"col"}," ACCIONES ")])],-1),je={class:"text-capitalize text-base font-weight-semibold"},He=i("br",null,null,-1),Xe={style:{"font-size":"12px"}},Ke={class:"text-base"},We={class:"text-center",style:{width:"5rem"}},Ye={key:0,class:"text-error",style:{"margin-right":"10px"}},Ze=i("tr",null,[i("td",{colspan:"7",class:"text-center"}," No existen periodos creados ")],-1),eo=[Ze],oo={class:"text-sm text-disabled"},Ho={__name:"index",setup(I){ie(),re();const h=de(),G=ne();ue();const N=a(""),F=a(),B=a(),C=a(),f=a(10),c=a(1),g=a(1),m=a(0),b=a(0),v=a([]),w=a([]),D=a([]),V=a([]),k=a([]);a();const O=a();x(()=>{G.fetchEmpresas({q:N.value,status:C.value,plan:B.value,role:F.value,perPage:f.value,currentPage:c.value,user:JSON.parse(sessionStorage.getItem("userData")).id,origen:"ifluc"}).then(u=>{w.value=u.data.empresas,g.value=u.data.totalPage,b.value=u.data.totalEmpresas}).catch(u=>{console.error(u)})});const S=()=>{h.fetchPeriodos({q:N.value,status:C.value,plan:B.value,role:F.value,perPage:f.value,currentPage:c.value,user:JSON.parse(sessionStorage.getItem("userData")).id,origen:"ifluc"}).then(u=>{console.log(u.data.periodos),v.value=u.data.periodos,g.value=1,m.value=u.data.periodos.length,v.value.forEach(o=>{const l=o.periodo+1;o.isDuplicated=v.value.some(_=>_.periodo===l&&_.empresaId===o.empresaId)})}).catch(u=>{console.error(u)})};x(S),x(()=>{c.value>g.value&&(c.value=g.value)});const J=a(!1);x(()=>{c.value>g.value&&(c.value=g.value)});const oe=Ve(()=>{const u=v.value.length?(c.value-1)*f.value+1:0,o=v.value.length+(c.value-1)*f.value;return`Mostrando ${u} a ${o} de ${m.value} registros`}),R=a(!1),U=a(!1),p=a("0"),$=u=>{h.eliminarPeriodoSeleccionado(u).then(o=>{S()})},M=(u,o)=>{D.value[o]=!0,console.log("periodo",u),console.log("index",o)},j=u=>{R.value=!0},H=(u,o)=>{try{D.value[o]=!0,V.value[o]=60,k.value[o]=setInterval(()=>{V.value[o]--},1e3),O.value=o,U.value=!0}catch(l){console.error("Error al descargar el reporte Excel:",l)}},X=u=>{localStorage.removeItem("reporteId"),h.addPeriodo(u),S()};return Pe(async()=>{await S()}),(u,o)=>(P(),q("section",null,[t(pe,null,{default:n(()=>[t(L,{cols:"12"},{default:n(()=>[t(ce,{title:"Periodos"},{default:n(()=>[b.value<1?(P(),q("span",Be,"DEBE CREAR UNA EMPRESA PARA GENERAR UN PERIODO")):te("",!0),t(Y,{class:"d-flex flex-wrap py-4 gap-4"},{default:n(()=>[i("div",Je,[t(Z,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=l=>f.value=l),density:"compact",variant:"outlined",items:[10,20,30,50]},null,8,["modelValue"])]),i("div",Me,[i("div",Qe,[t(Re,{modelValue:N.value,"onUpdate:modelValue":o[1]||(o[1]=l=>N.value=l),placeholder:"Search",density:"compact"},null,8,["modelValue"])]),b.value>0?(P(),W(E,{key:0,"prepend-icon":"tabler-plus",onClick:o[2]||(o[2]=l=>J.value=!0)},{default:n(()=>[A(" Nuevo Periodo ")]),_:1})):(P(),W(E,{key:1,"prepend-icon":"tabler-plus",disabled:""},{default:n(()=>[A(" Nuevo Periodo ")]),_:1}))])]),_:1}),t(se),t($e,{class:"text-no-wrap"},{default:n(()=>[Ge,i("tbody",null,[(P(!0),q(be,null,we(v.value,(l,_)=>(P(),q("tr",{key:l.id,style:{height:"3.75rem"}},[i("td",null,[i("span",je,[A(y(l.enterprisesifluc.nombre),1),He,A("RUC: "),i("span",Xe,y(l.empresaId),1)])]),i("td",null,[i("span",Ke,y(l.periodo),1)]),i("td",null,y(l.createdAt),1),i("td",We,[D.value[_]?(P(),q("span",Ye,"Espere ... "+y(V.value[_]),1)):te("",!0),t(E,{icon:"",size:"x-small",color:"default",variant:"text",disabled:l.isDuplicated,onClick:e=>{p.value=l,H(l.id,_)},loading:D.value[_]},{default:n(()=>[t(Q,{size:"22",icon:"tabler-copy"})]),_:2},1032,["disabled","onClick","loading"]),t(E,{icon:"",size:"x-small",color:"default",variant:"text",onClick:e=>{p.value=l.id,j(l.id)}},{default:n(()=>[t(Q,{size:"22",icon:"tabler-trash"})]),_:2},1032,["onClick"])])]))),128))]),De(i("tfoot",null,eo,512),[[Se,!v.value.length]])]),_:1}),t(se),t(Y,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3 px-5"},{default:n(()=>[i("span",oo,y(d(oe)),1),t(Ae,{modelValue:c.value,"onUpdate:modelValue":o[3]||(o[3]=l=>c.value=l),size:"small","total-visible":5,length:g.value},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:1}),t(Ee,{isDialogVisible:R.value,"onUpdate:isDialogVisible":o[4]||(o[4]=l=>R.value=l),"confirmation-msg":"Estas seguro de que lo que deseas es eliminar este periodo?, al hacerlo se eliminaran todos los datos relacionados. Esta acci\xF3n no es reversible","id-periodo":p.value,onConfirm:o[5]||(o[5]=l=>$(p.value))},null,8,["isDialogVisible","id-periodo"]),t(Ie,{isDialogVisible:U.value,"onUpdate:isDialogVisible":o[6]||(o[6]=l=>U.value=l),"confirmation-msg":"Est\xE1 seguro de que desea duplicar este periodo?, tal acci\xF3n generar\xE1 que se cree un nuevo periodo, donde los datos del periodo actual pasan a periodo anterior","id-periodo":p.value,"indice-duplicar-periodo":O.value,onConfirm:o[7]||(o[7]=l=>M(p.value,O.value))},null,8,["isDialogVisible","id-periodo","indice-duplicar-periodo"]),t(Fe,{isDrawerOpen:J.value,"onUpdate:isDrawerOpen":o[8]||(o[8]=l=>J.value=l),onUserData:X},null,8,["isDrawerOpen"])]))}};export{Ho as default};
