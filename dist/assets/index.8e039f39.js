import{L as me,k as a,b9 as le,j as se,Q as x,o as S,b as Y,x as n,m as i,p as o,V as G,q as d,P as ve,y as W,ba as fe,G as O,z as R,ag as oe,$ as ge,a0 as _e,w as he,aF as Ve,c as Q,I as Pe,F as be,a as we,C as De,D as Se}from"./index.33948166.js";import{r as ae}from"./validators.d71d6c94.js";import{u as re}from"./useEmpresaListStore.8aeb34ce.js";import{u as ie}from"./useSuperciasListStore.5ad71a23.js";import{u as ne}from"./usePeriodoListStore.1bf8907d.js";import{o as xe,a as ye,_ as Ee,b as Ie}from"./ConfirmDuplicatePeriodoDialog.666ddec7.js";import"./reportStore.5b74d996.js";import{V as Ne}from"./VSpacer.ec68c105.js";import{V as y}from"./VBtn.dfad1294.js";import{a as ue}from"./VCard.a5913b38.js";import{V as Z}from"./VCardText.f212c10e.js";import{V as Ce}from"./VForm.c7f983c8.js";import{V as de}from"./VRow.92104217.js";import{V as z}from"./VCol.4ace162b.js";import{V as ee}from"./VSelect.d5b9f730.js";import{V as Oe}from"./VNavigationDrawer.493d9a60.js";import{d as Re}from"./VTextField.f42a9e4e.js";import{V as te}from"./VDivider.60486116.js";import{V as $e}from"./VTable.7161d966.js";import{V as Ae}from"./VPagination.1ffa69d9.js";import"./index.0d4b9ec4.js";import"./axios.80581068.js";import"./environments.3b606d6b.js";import"./VDialog.91a8b4ab.js";import"./scopeId.efc7ecf9.js";import"./router.0d3dece4.js";import"./lazy.29fd26a4.js";import"./easing.36b781ab.js";import"./location.5b00e6f1.js";import"./VImg.263fbd81.js";import"./forwardRefs.c003b6b8.js";import"./dialog-transition.a6fea1a6.js";import"./createSimpleFunctional.91ff66ba.js";import"./group.f4dc1b21.js";import"./position.b5ad042e.js";import"./VAvatar.952e8192.js";import"./form.617ed55b.js";/* empty css              */import"./VList.bd876076.js";import"./index.0971ba6c.js";import"./VMenu.60aea287.js";import"./VCheckboxBtn.5708c79c.js";import"./VSelectionControl.39694940.js";import"./VChip.0e2cb315.js";import"./ssrBoot.5a8908fe.js";const ce=E=>(ge("data-v-fc20c5ad"),E=E(),_e(),E),ke={class:"d-flex align-center pa-6 pb-1"},Ue=ce(()=>i("h6",{class:"text-h6"}," Nuevo Periodo ",-1)),ze={class:"custom-loader"},Te={class:"pl-2 pr-2"},qe=ce(()=>i("span",null,"Cancelar",-1)),Le={__name:"AddNewPeriodo",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(E,{emit:h}){const j=E,I=re(),T=ie(),q=ne(),N=a(!1),v=a(),c=a(""),g=a([]),p=a({title:"Tu Empresa",value:"1717170110",periodosifluc:[]}),P=a([]),m=a([2017,2018,2019,2020,2021,2022,2023,2024,2025]),b=a([]),$=a(""),V=a(1),L=a(1),w=a(1e3);le();const A=se(),F=()=>{h("update:isDrawerOpen",!1),oe(()=>{var e,s;(e=v.value)==null||e.reset(),(s=v.value)==null||s.resetValidation()})};x(()=>{I.fetchEmpresas({q:$.value,status:null,plan:null,role:null,perPage:w.value,currentPage:V.value,user:JSON.parse(sessionStorage.getItem("userData")).id,origen:"ifluc"}).then(e=>{const s=e.data.empresas,r=[];s.forEach(k=>{let U={title:k.nombre,value:k.ruc,periodos:k.periodosifluc};r.push(U)}),P.value=r}).catch(e=>{console.error(e)})}),x(()=>{V.value>L.value&&(V.value=L.value)}),x(()=>{q.fetchPeriodos({q:$.value,perPage:w.value,currentPage:V.value,user:JSON.parse(sessionStorage.getItem("userData")).id,origen:"ifluc"}).then(e=>{if(console.log("response periodos: ",e),g.value=e.data.periodos,L.value=e.data.totalPage,Array.isArray(e.data.periodos)){const s=e.data.periodos.map(r=>r.periodo);b.value=m.value.filter(r=>!s.includes(r))}else b.value=[...m.value]}).catch(e=>{console.error(e)})});const _=e=>{console.log("reporteId: ",e),e===0?setTimeout(()=>{let s=JSON.parse(localStorage.getItem("periodonuevo"));_(s)},1e3):u(e)},H=()=>{var e;(e=v.value)==null||e.validate().then(({valid:s})=>{s&&(console.log("empresa: ",p.value),console.log("empresa: ",p.value.value),f.value=!0,localStorage.setItem("empresanueva",JSON.stringify(p.value.value)),h("userData",{periodo:Number(c.value),empresaId:p.value.value,userId:JSON.parse(sessionStorage.getItem("userData")).id}),oe(()=>{setTimeout(()=>{console.log(Number(localStorage.getItem("periodonuevo")));let r=JSON.parse(localStorage.getItem("periodonuevo"));_(r)},2e3)}))})},f=a(!1),C=a(60),M=a(null),X=e=>{e.periodoId>0?(console.log("reporte: ",e),t(e),l(),f.value=!0):console.error("Error al guardar el reporte: Periodo ID inv\xE1lido.")},u=async e=>{console.log("guardarReporteTxt: ",e);try{const s=await xe(),r=await ye(s,e);X(r)}catch(s){console.error("Error al guardar reporte TXT:",s)}},t=e=>{T.addReporteSupercias(e).then(s=>{console.log(s),h("update:isDrawerOpen",!1),A.replace("/pages/supercias/list")})},l=()=>{f.value=!0,C.value=60,M.value=setInterval(()=>{C.value>0?C.value-=1:D()},1e3)},D=()=>{clearInterval(M),f.value=!1},K=()=>{let e=P.value,s=[];e.forEach(r=>{if((r!=null&&r.value?r==null?void 0:r.value:r)===p.value.value)if(s=r==null?void 0:r.periodos,Array.isArray(s)){const k=s.map(U=>U.periodo);b.value=m.value.filter(U=>!k.includes(U))}else b.value=[...m.value]})},pe=e=>{h("update:isDrawerOpen",e)};return(e,s)=>(S(),Y(Oe,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":j.isDrawerOpen,"onUpdate:modelValue":pe},{default:n(()=>[i("div",ke,[Ue,o(Ne),o(y,{variant:"tonal",color:"default",icon:"",size:"32",class:"rounded",onClick:F},{default:n(()=>[o(G,{size:"18",icon:"tabler-x"})]),_:1})]),o(d(ve),{options:{wheelPropagation:!1}},{default:n(()=>[o(ue,{flat:""},{default:n(()=>[o(Z,null,{default:n(()=>[o(Ce,{ref_key:"refForm",ref:v,modelValue:d(N),"onUpdate:modelValue":s[2]||(s[2]=r=>W(N)?N.value=r:null),onSubmit:fe(H,["prevent"])},{default:n(()=>[o(de,null,{default:n(()=>[o(z,{cols:"12"},{default:n(()=>[o(ee,{modelValue:d(p),"onUpdate:modelValue":[s[0]||(s[0]=r=>W(p)?p.value=r:null),K],hint:`${d(p).value}, ${d(p).title}`,items:d(P),rules:[d(ae)],"item-title":"title","item-value":"value",label:"Empresas","persistent-hint":"","return-object":"","single-line":"",placeholder:"Seleccione la empresa"},null,8,["modelValue","hint","items","rules"])]),_:1}),o(z,{cols:"12"},{default:n(()=>[o(ee,{modelValue:d(c),"onUpdate:modelValue":s[1]||(s[1]=r=>W(c)?c.value=r:null),label:"Periodo",rules:[d(ae)],items:d(b)},null,8,["modelValue","rules","items"])]),_:1}),o(z,{cols:"12"},{default:n(()=>[o(y,{type:"submit",class:"me-4",style:{"font-size":"12px",width:"100%"},loading:d(f),disabled:d(f)||d(c)==""},{loader:n(()=>[i("span",ze,[o(G,{icon:"tabler-refresh"})]),i("span",Te,"Creando reporte, espere "+O(d(C))+" ...",1)]),default:n(()=>[R(" Crear Periodo ")]),_:1},8,["loading","disabled"])]),_:1}),o(z,{cols:"12"},{default:n(()=>[o(y,{type:"reset",variant:"tonal",style:{"font-size":"12px",width:"100%"},color:"secondary",onClick:F,loading:d(f),disabled:d(f)},{loader:n(()=>[qe]),default:n(()=>[R(" Cancelar ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Fe=me(Le,[["__scopeId","data-v-fc20c5ad"]]);const Be={key:0,class:"text-sm ml-20",style:{color:"red","margin-left":"23px","margin-top":"-20px",position:"absolute"}},Je={class:"me-3",style:{width:"80px"}},Me={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Qe={style:{width:"10rem"}},Ge=i("thead",null,[i("tr",null,[i("th",{scope:"col"}," EMPRESA "),i("th",{scope:"col"}," PERIODO "),i("th",{scope:"col"}," FECHA CREACI\xD3N "),i("th",{scope:"col"}," ACCIONES ")])],-1),je={class:"text-capitalize text-base font-weight-semibold"},He=i("br",null,null,-1),Xe={style:{"font-size":"12px"}},Ke={class:"text-base"},We={class:"text-center",style:{width:"5rem"}},Ye=i("tr",null,[i("td",{colspan:"7",class:"text-center"}," No existen periodos creados ")],-1),Ze=[Ye],eo={class:"text-sm text-disabled"},jo={__name:"index",setup(E){se(),le();const h=ne(),j=re();ie();const I=a(""),T=a(),q=a(),N=a(),v=a(10),c=a(1),g=a(1),p=a(0),P=a(0),m=a([]),b=a([]),$=a([]);a();const V=a();x(()=>{j.fetchEmpresas({q:I.value,status:N.value,plan:q.value,role:T.value,perPage:v.value,currentPage:c.value,user:JSON.parse(sessionStorage.getItem("userData")).id,origen:"ifluc"}).then(u=>{b.value=u.data.empresas,g.value=u.data.totalPage,P.value=u.data.totalEmpresas}).catch(u=>{console.error(u)})});const w=()=>{h.fetchPeriodos({q:I.value,status:N.value,plan:q.value,role:T.value,perPage:v.value,currentPage:c.value,user:JSON.parse(sessionStorage.getItem("userData")).id,origen:"ifluc"}).then(u=>{console.log(u.data.periodos),m.value=u.data.periodos,g.value=1,p.value=u.data.periodos.length,m.value.forEach(t=>{const l=t.periodo+1;t.isDuplicated=m.value.some(D=>D.periodo===l&&D.empresaId===t.empresaId)})}).catch(u=>{console.error(u)})};x(w),x(()=>{c.value>g.value&&(c.value=g.value)});const A=a(!1);x(()=>{c.value>g.value&&(c.value=g.value)});const F=he(()=>{const u=m.value.length?(c.value-1)*v.value+1:0,t=m.value.length+(c.value-1)*v.value;return`Mostrando ${u} a ${t} de ${p.value} registros`}),B=a(!1),J=a(!1),_=a("0"),H=u=>{h.eliminarPeriodoSeleccionado(u).then(t=>{w()})},f=(u,t)=>{$.value[t]=!0,console.log("periodo",u),console.log("index",t)},C=u=>{B.value=!0},M=(u,t)=>{V.value=t,J.value=!0},X=u=>{localStorage.removeItem("reporteId"),h.addPeriodo(u),w()};return Ve(async()=>{await w()}),(u,t)=>(S(),Q("section",null,[o(de,null,{default:n(()=>[o(z,{cols:"12"},{default:n(()=>[o(ue,{title:"Periodos"},{default:n(()=>[P.value<1?(S(),Q("span",Be,"DEBE CREAR UNA EMPRESA PARA GENERAR UN PERIODO")):Pe("",!0),o(Z,{class:"d-flex flex-wrap py-4 gap-4"},{default:n(()=>[i("div",Je,[o(ee,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=l=>v.value=l),density:"compact",variant:"outlined",items:[10,20,30,50]},null,8,["modelValue"])]),i("div",Me,[i("div",Qe,[o(Re,{modelValue:I.value,"onUpdate:modelValue":t[1]||(t[1]=l=>I.value=l),placeholder:"Search",density:"compact"},null,8,["modelValue"])]),P.value>0?(S(),Y(y,{key:0,"prepend-icon":"tabler-plus",onClick:t[2]||(t[2]=l=>A.value=!0)},{default:n(()=>[R(" Nuevo Periodo ")]),_:1})):(S(),Y(y,{key:1,"prepend-icon":"tabler-plus",disabled:""},{default:n(()=>[R(" Nuevo Periodo ")]),_:1}))])]),_:1}),o(te),o($e,{class:"text-no-wrap"},{default:n(()=>[Ge,i("tbody",null,[(S(!0),Q(be,null,we(m.value,(l,D)=>(S(),Q("tr",{key:l.id,style:{height:"3.75rem"}},[i("td",null,[i("span",je,[R(O(l.enterprisesifluc.nombre),1),He,R("RUC: "),i("span",Xe,O(l.empresaId),1)])]),i("td",null,[i("span",Ke,O(l.periodo),1)]),i("td",null,O(l.createdAt),1),i("td",We,[o(y,{icon:"",size:"x-small",color:"default",variant:"text",disabled:l.isDuplicated,onClick:K=>{_.value=l,M(l.id,D)},loading:$.value[D]},{default:n(()=>[o(G,{size:"22",icon:"tabler-copy"})]),_:2},1032,["disabled","onClick","loading"]),o(y,{icon:"",size:"x-small",color:"default",variant:"text",onClick:K=>{_.value=l.id,C(l.id)}},{default:n(()=>[o(G,{size:"22",icon:"tabler-trash"})]),_:2},1032,["onClick"])])]))),128))]),De(i("tfoot",null,Ze,512),[[Se,!m.value.length]])]),_:1}),o(te),o(Z,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3 px-5"},{default:n(()=>[i("span",eo,O(d(F)),1),o(Ae,{modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=l=>c.value=l),size:"small","total-visible":5,length:g.value},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:1}),o(Ee,{isDialogVisible:B.value,"onUpdate:isDialogVisible":t[4]||(t[4]=l=>B.value=l),"confirmation-msg":"Estas seguro de que lo que deseas es eliminar este periodo?, al hacerlo se eliminaran todos los datos relacionados. Esta acci\xF3n no es reversible","id-periodo":_.value,onConfirm:t[5]||(t[5]=l=>H(_.value))},null,8,["isDialogVisible","id-periodo"]),o(Ie,{isDialogVisible:J.value,"onUpdate:isDialogVisible":t[6]||(t[6]=l=>J.value=l),"confirmation-msg":"Est\xE1 seguro de que desea duplicar este periodo?, tal acci\xF3n generar\xE1 que se cree un nuevo periodo, donde los datos del periodo actual pasan a periodo anterior","id-periodo":_.value,"indice-duplicar-periodo":V.value,onConfirm:t[7]||(t[7]=l=>f(_.value,V.value))},null,8,["isDialogVisible","id-periodo","indice-duplicar-periodo"]),o(Fe,{isDrawerOpen:A.value,"onUpdate:isDrawerOpen":t[8]||(t[8]=l=>A.value=l),onUserData:X},null,8,["isDrawerOpen"])]))}};export{jo as default};
