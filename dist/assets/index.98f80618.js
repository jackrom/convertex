import{L as me,k as t,b9 as oe,j as te,Q as $,o as h,b as G,x as n,m as r,p as o,V as j,q as d,P as ve,y as Q,ba as fe,G as E,z as C,ag as Y,$ as ge,a0 as _e,aF as Ve,c as T,I as he,F as be,a as we,C as De,D as xe}from"./index.33948166.js";import{r as Z}from"./validators.d71d6c94.js";import{u as ae}from"./useEmpresaListStore.8aeb34ce.js";import{u as le}from"./useSuperciasListStore.5ad71a23.js";import{u as se}from"./usePeriodoListStore.1bf8907d.js";import{o as Se,a as Pe,_ as ye,b as Ee}from"./ConfirmDuplicatePeriodoDialog.666ddec7.js";import"./reportStore.5b74d996.js";import{V as Ce}from"./VSpacer.ec68c105.js";import{V as b}from"./VBtn.dfad1294.js";import{a as re}from"./VCard.a5913b38.js";import{V as H}from"./VCardText.f212c10e.js";import{V as Ne}from"./VForm.c7f983c8.js";import{V as ie}from"./VRow.92104217.js";import{V as F}from"./VCol.4ace162b.js";import{V as X}from"./VSelect.d5b9f730.js";import{V as Ie}from"./VNavigationDrawer.493d9a60.js";import{d as Oe}from"./VTextField.f42a9e4e.js";import{V as ee}from"./VDivider.60486116.js";import{V as Re}from"./VTable.7161d966.js";import{V as Ae}from"./VPagination.1ffa69d9.js";import"./index.0d4b9ec4.js";import"./axios.80581068.js";import"./environments.3b606d6b.js";import"./VDialog.91a8b4ab.js";import"./scopeId.efc7ecf9.js";import"./router.0d3dece4.js";import"./lazy.29fd26a4.js";import"./easing.36b781ab.js";import"./location.5b00e6f1.js";import"./VImg.263fbd81.js";import"./forwardRefs.c003b6b8.js";import"./dialog-transition.a6fea1a6.js";import"./createSimpleFunctional.91ff66ba.js";import"./group.f4dc1b21.js";import"./position.b5ad042e.js";import"./VAvatar.952e8192.js";import"./form.617ed55b.js";/* empty css              */import"./VList.bd876076.js";import"./index.0971ba6c.js";import"./VMenu.60aea287.js";import"./VCheckboxBtn.5708c79c.js";import"./VSelectionControl.39694940.js";import"./VChip.0e2cb315.js";import"./ssrBoot.5a8908fe.js";const ne=w=>(ge("data-v-307807b9"),w=w(),_e(),w),ke={class:"d-flex align-center pa-6 pb-1"},Fe=ne(()=>r("h6",{class:"text-h6"}," Nuevo Periodo ",-1)),$e={class:"custom-loader"},Ue={class:"pl-2 pr-2"},ze=ne(()=>r("span",null,"Cancelar",-1)),Te={__name:"AddNewFlujo",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(w,{emit:_}){const q=w,N=ae(),L=le(),B=se(),I=t(!1),f=t(),p=t(""),D=t([]),c=t({title:"Tu Empresa",value:"1717170110",periodosifluc:[]}),x=t([]),S=t([2017,2018,2019,2020,2021,2022,2023,2024,2025]),g=t([]),P=t(""),O=t(1),V=t(1),y=t(1e3);oe();const R=te(),v=()=>{_("update:isDrawerOpen",!1),Y(()=>{var e,l;(e=f.value)==null||e.reset(),(l=f.value)==null||l.resetValidation()})};$(()=>{N.fetchEmpresas({q:P.value,status:null,plan:null,role:null,perPage:y.value,currentPage:O.value,user:JSON.parse(sessionStorage.getItem("userData")).id,origen:"ifluc"}).then(e=>{const l=e.data.empresas,s=[];l.forEach(A=>{let k={title:A.nombre,value:A.ruc,periodos:A.periodosifluc};s.push(k)}),x.value=s}).catch(e=>{console.error(e)})}),$(()=>{O.value>V.value&&(O.value=V.value)}),$(()=>{B.fetchPeriodos({q:P.value,perPage:y.value,currentPage:O.value,user:JSON.parse(sessionStorage.getItem("userData")).id,origen:"ifluc"}).then(e=>{if(console.log("response periodos: ",e),D.value=e.data.periodos,V.value=e.data.totalPage,Array.isArray(e.data.periodos)){const l=e.data.periodos.map(s=>s.periodo);g.value=S.value.filter(s=>!l.includes(s))}else g.value=[...S.value]}).catch(e=>{console.error(e)})});const U=e=>{console.log("reporteId: ",e),e===0?setTimeout(()=>{let l=JSON.parse(localStorage.getItem("periodonuevo"));U(l)},1e3):z(e)},J=()=>{var e;(e=f.value)==null||e.validate().then(({valid:l})=>{l&&(console.log("empresa: ",c.value),console.log("empresa: ",c.value.value),m.value=!0,localStorage.setItem("empresanueva",JSON.stringify(c.value.value)),_("userData",{periodo:Number(p.value),empresaId:c.value.value,userId:JSON.parse(sessionStorage.getItem("userData")).id}),Y(()=>{setTimeout(()=>{console.log(Number(localStorage.getItem("periodonuevo")));let s=JSON.parse(localStorage.getItem("periodonuevo"));U(s)},2e3)}))})},m=t(!1),u=t(60),i=t(null),a=e=>{e.periodoId>0?(console.log("reporte: ",e),M(e),ue(),m.value=!0):console.error("Error al guardar el reporte: Periodo ID inv\xE1lido.")},z=async e=>{console.log("guardarReporteTxt: ",e);try{const l=await Se(),s=await Pe(l,e);a(s)}catch(l){console.error("Error al guardar reporte TXT:",l)}},M=e=>{L.addReporteSupercias(e).then(l=>{console.log(l),_("update:isDrawerOpen",!1),R.replace("/pages/supercias/list")})},ue=()=>{m.value=!0,u.value=60,i.value=setInterval(()=>{u.value>0?u.value-=1:de()},1e3)},de=()=>{clearInterval(i),m.value=!1},ce=()=>{let e=x.value,l=[];e.forEach(s=>{if((s!=null&&s.value?s==null?void 0:s.value:s)===c.value.value)if(l=s==null?void 0:s.periodos,Array.isArray(l)){const A=l.map(k=>k.periodo);g.value=S.value.filter(k=>!A.includes(k))}else g.value=[...S.value]})},pe=e=>{_("update:isDrawerOpen",e)};return(e,l)=>(h(),G(Ie,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":q.isDrawerOpen,"onUpdate:modelValue":pe},{default:n(()=>[r("div",ke,[Fe,o(Ce),o(b,{variant:"tonal",color:"default",icon:"",size:"32",class:"rounded",onClick:v},{default:n(()=>[o(j,{size:"18",icon:"tabler-x"})]),_:1})]),o(d(ve),{options:{wheelPropagation:!1}},{default:n(()=>[o(re,{flat:""},{default:n(()=>[o(H,null,{default:n(()=>[o(Ne,{ref_key:"refForm",ref:f,modelValue:d(I),"onUpdate:modelValue":l[2]||(l[2]=s=>Q(I)?I.value=s:null),onSubmit:fe(J,["prevent"])},{default:n(()=>[o(ie,null,{default:n(()=>[o(F,{cols:"12"},{default:n(()=>[o(X,{modelValue:d(c),"onUpdate:modelValue":[l[0]||(l[0]=s=>Q(c)?c.value=s:null),ce],hint:`${d(c).value}, ${d(c).title}`,items:d(x),rules:[d(Z)],"item-title":"title","item-value":"value",label:"Empresas","persistent-hint":"","return-object":"","single-line":"",placeholder:"Seleccione la empresa"},null,8,["modelValue","hint","items","rules"])]),_:1}),o(F,{cols:"12"},{default:n(()=>[o(X,{modelValue:d(p),"onUpdate:modelValue":l[1]||(l[1]=s=>Q(p)?p.value=s:null),label:"Periodo",rules:[d(Z)],items:d(g)},null,8,["modelValue","rules","items"])]),_:1}),o(F,{cols:"12"},{default:n(()=>[o(b,{type:"submit",class:"me-4",style:{"font-size":"12px",width:"100%"},loading:d(m),disabled:d(m)||d(p)==""},{loader:n(()=>[r("span",$e,[o(j,{icon:"tabler-refresh"})]),r("span",Ue,"Creando reporte, espere "+E(d(u))+" ...",1)]),default:n(()=>[C(" Crear Periodo ")]),_:1},8,["loading","disabled"])]),_:1}),o(F,{cols:"12"},{default:n(()=>[o(b,{type:"reset",variant:"tonal",style:{"font-size":"12px",width:"100%"},color:"secondary",onClick:v,loading:d(m),disabled:d(m)},{loader:n(()=>[ze]),default:n(()=>[C(" Cancelar ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},je=me(Te,[["__scopeId","data-v-307807b9"]]);const qe={key:0,class:"text-sm ml-20",style:{color:"red","margin-left":"23px","margin-top":"-20px",position:"absolute"}},Le={class:"me-3",style:{width:"80px"}},Be={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Je={style:{width:"10rem"}},Me=r("thead",null,[r("tr",null,[r("th",{scope:"col"}," EMPRESA "),r("th",{scope:"col"}," PERIODO "),r("th",{scope:"col"}," FECHA CREACI\xD3N "),r("th",{scope:"col"}," ACCIONES ")])],-1),Qe={class:"text-capitalize text-base font-weight-semibold"},Ge=r("br",null,null,-1),He={style:{"font-size":"12px"}},Xe={class:"text-base"},Ke={class:"text-center",style:{width:"5rem"}},We=r("tr",null,[r("td",{colspan:"7",class:"text-center"}," No existen flujos creados ")],-1),Ye=[We],Ze={class:"text-sm text-disabled"},Qo={__name:"index",setup(w){te(),oe();const _=se(),q=ae();le();const N=t(""),L=t(),B=t(),I=t(),f=t(10),p=t(1),D=t(1);t(0);const c=t(0),x=t([]),S=t([]),g=t([]);t();const P=t();$(()=>{q.fetchEmpresas({q:N.value,status:I.value,plan:B.value,role:L.value,perPage:f.value,currentPage:p.value,user:JSON.parse(sessionStorage.getItem("userData")).id,origen:"ifluc"}).then(u=>{S.value=u.data.empresas,D.value=u.data.totalPage,c.value=u.data.totalEmpresas}).catch(u=>{console.error(u)})});const V=t(!1);$(()=>{p.value>D.value&&(p.value=D.value)});const y=t(!1),R=t(!1),v=t("0"),K=u=>{_.eliminarPeriodoSeleccionado(u).then(i=>{})},W=(u,i)=>{g.value[i]=!0},U=u=>{y.value=!0},J=(u,i)=>{P.value=i,R.value=!0},m=u=>{localStorage.removeItem("reporteId"),_.addPeriodo(u)};return Ve(async()=>{}),(u,i)=>(h(),T("section",null,[o(ie,null,{default:n(()=>[o(F,{cols:"12"},{default:n(()=>[o(re,{title:"Flujos"},{default:n(()=>[c.value<1?(h(),T("span",qe,"DEBE CREAR UNA EMPRESA PARA GENERAR UN PERIODO")):he("",!0),o(H,{class:"d-flex flex-wrap py-4 gap-4"},{default:n(()=>[r("div",Le,[o(X,{modelValue:f.value,"onUpdate:modelValue":i[0]||(i[0]=a=>f.value=a),density:"compact",variant:"outlined",items:[10,20,30,50]},null,8,["modelValue"])]),r("div",Be,[r("div",Je,[o(Oe,{modelValue:N.value,"onUpdate:modelValue":i[1]||(i[1]=a=>N.value=a),placeholder:"Search",density:"compact"},null,8,["modelValue"])]),c.value>0?(h(),G(b,{key:0,"prepend-icon":"tabler-plus",onClick:i[2]||(i[2]=a=>V.value=!0)},{default:n(()=>[C(" Nuevo Flujo Din\xE1mico ")]),_:1})):(h(),G(b,{key:1,"prepend-icon":"tabler-plus",disabled:""},{default:n(()=>[C(" Nuevo Flujo Din\xE1mico ")]),_:1}))])]),_:1}),o(ee),o(Re,{class:"text-no-wrap"},{default:n(()=>[Me,r("tbody",null,[(h(!0),T(be,null,we(x.value,(a,z)=>(h(),T("tr",{key:a.id,style:{height:"3.75rem"}},[r("td",null,[r("span",Qe,[C(E(a.enterprisesifluc.nombre),1),Ge,C("RUC: "),r("span",He,E(a.empresaId),1)])]),r("td",null,[r("span",Xe,E(a.periodo),1)]),r("td",null,E(a.createdAt),1),r("td",Ke,[o(b,{icon:"",size:"x-small",color:"default",variant:"text",disabled:a.isDuplicated,onClick:M=>{v.value=a,J(a.id,z)},loading:g.value[z]},{default:n(()=>[o(j,{size:"22",icon:"tabler-copy"})]),_:2},1032,["disabled","onClick","loading"]),o(b,{icon:"",size:"x-small",color:"default",variant:"text",onClick:M=>{v.value=a.id,U(a.id)}},{default:n(()=>[o(j,{size:"22",icon:"tabler-trash"})]),_:2},1032,["onClick"])])]))),128))]),De(r("tfoot",null,Ye,512),[[xe,!x.value.length]])]),_:1}),o(ee),o(H,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3 px-5"},{default:n(()=>[r("span",Ze,E(u.paginationData),1),o(Ae,{modelValue:p.value,"onUpdate:modelValue":i[3]||(i[3]=a=>p.value=a),size:"small","total-visible":5,length:D.value},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:1}),o(ye,{isDialogVisible:y.value,"onUpdate:isDialogVisible":i[4]||(i[4]=a=>y.value=a),"confirmation-msg":"Estas seguro de que lo que deseas es eliminar este periodo?, al hacerlo se eliminaran todos los datos relacionados. Esta acci\xF3n no es reversible","id-periodo":v.value,onConfirm:i[5]||(i[5]=a=>K(v.value))},null,8,["isDialogVisible","id-periodo"]),o(Ee,{isDialogVisible:R.value,"onUpdate:isDialogVisible":i[6]||(i[6]=a=>R.value=a),"confirmation-msg":"Est\xE1 seguro de que desea duplicar este periodo?, tal acci\xF3n generar\xE1 que se cree un nuevo periodo, donde los datos del periodo actual pasan a periodo anterior","id-periodo":v.value,"indice-duplicar-periodo":P.value,onConfirm:i[7]||(i[7]=a=>W(v.value,P.value))},null,8,["isDialogVisible","id-periodo","indice-duplicar-periodo"]),o(je,{isDrawerOpen:V.value,"onUpdate:isDrawerOpen":i[8]||(i[8]=a=>V.value=a),onUserData:m},null,8,["isDrawerOpen"])]))}};export{Qo as default};
