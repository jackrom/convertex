import{k as t,b9 as W,j as Z,o as b,b as $,x as l,m as a,p as e,V as ee,q as i,P as pe,y as S,ba as fe,z as O,ag as X,G as V,Q as L,w as ve,c as z,I as F,F as _e,a as ge,C as Ve,D as he}from"./index.33948166.js";import{r as U,e as be}from"./validators.d71d6c94.js";import{V as xe}from"./VSpacer.ec68c105.js";import{V as P}from"./VBtn.dfad1294.js";import{a as Q,c as Ee}from"./VCard.a5913b38.js";import{V as B}from"./VCardText.f212c10e.js";import{V as De}from"./VForm.c7f983c8.js";import{V as ae}from"./VRow.92104217.js";import{V as D}from"./VCol.4ace162b.js";import{d as I}from"./VTextField.f42a9e4e.js";import{V as ye}from"./VNavigationDrawer.493d9a60.js";import{u as j}from"./useEmpresaListStore.8aeb34ce.js";import{J as we}from"./formatters.183728af.js";import{V as ke}from"./VDialog.91a8b4ab.js";import{V as Ce}from"./VSelect.d5b9f730.js";import{V as Y}from"./VDivider.60486116.js";import{V as Se}from"./VTable.7161d966.js";import{V as K}from"./VAvatar.952e8192.js";import{V as Ie}from"./VImg.263fbd81.js";import{V as Ne}from"./VPagination.1ffa69d9.js";import"./index.0d4b9ec4.js";import"./createSimpleFunctional.91ff66ba.js";import"./group.f4dc1b21.js";import"./router.0d3dece4.js";import"./position.b5ad042e.js";import"./location.5b00e6f1.js";import"./form.617ed55b.js";import"./forwardRefs.c003b6b8.js";/* empty css              */import"./index.0971ba6c.js";import"./easing.36b781ab.js";import"./ssrBoot.5a8908fe.js";import"./axios.80581068.js";import"./environments.3b606d6b.js";import"./reportStore.5b74d996.js";import"./scopeId.efc7ecf9.js";import"./lazy.29fd26a4.js";import"./dialog-transition.a6fea1a6.js";import"./VList.bd876076.js";import"./VMenu.60aea287.js";import"./VCheckboxBtn.5708c79c.js";import"./VSelectionControl.39694940.js";import"./VChip.0e2cb315.js";const Ue={class:"d-flex align-center pa-6 pb-1"},Oe=a("h6",{class:"text-h6"}," Nueva Empresa ",-1),Pe={__name:"AddNewEmpresa",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","userData"],setup(A,{emit:m}){const v=A,y=t(!1),_=t(),w=t(""),p=t(""),d=t(""),h=t(""),u=t(""),c=t(""),M=t(""),k=t("");W(),Z();const x=()=>{m("update:isDrawerOpen",!1),X(()=>{var E,s;(E=_.value)==null||E.reset(),(s=_.value)==null||s.resetValidation()})},C=()=>{var E;(E=_.value)==null||E.validate().then(({valid:s})=>{s&&(m("userData",{id:p.value,nombre:w.value,ruc:p.value,email:d.value,gerente:h.value,direccion:u.value,telefono:c.value,ciudad:M.value,provincia:k.value,origen:"ifluc",userId:JSON.parse(sessionStorage.getItem("userData")).id,activo:1}),m("update:isDrawerOpen",!1),X(()=>{var o,T;(o=_.value)==null||o.reset(),(T=_.value)==null||T.resetValidation()})),setTimeout(()=>{m("empresa-creada",!0)},1500)})},N=E=>{m("update:isDrawerOpen",E)};return(E,s)=>(b(),$(ye,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":v.isDrawerOpen,"onUpdate:modelValue":N},{default:l(()=>[a("div",Ue,[Oe,e(xe),e(P,{variant:"tonal",color:"default",icon:"",size:"32",class:"rounded",onClick:x},{default:l(()=>[e(ee,{size:"18",icon:"tabler-x"})]),_:1})]),e(i(pe),{options:{wheelPropagation:!1}},{default:l(()=>[e(Q,{flat:""},{default:l(()=>[e(B,null,{default:l(()=>[e(De,{ref_key:"refForm",ref:_,modelValue:i(y),"onUpdate:modelValue":s[8]||(s[8]=o=>S(y)?y.value=o:null),onSubmit:fe(C,["prevent"])},{default:l(()=>[e(ae,null,{default:l(()=>[e(D,{cols:"12"},{default:l(()=>[e(I,{modelValue:i(w),"onUpdate:modelValue":s[0]||(s[0]=o=>S(w)?w.value=o:null),rules:[i(U)],label:"Nombre"},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12"},{default:l(()=>[e(I,{modelValue:i(d),"onUpdate:modelValue":s[1]||(s[1]=o=>S(d)?d.value=o:null),rules:[i(U),i(be)],label:"Email"},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12"},{default:l(()=>[e(I,{modelValue:i(p),"onUpdate:modelValue":s[2]||(s[2]=o=>S(p)?p.value=o:null),rules:[i(U)],label:"ruc"},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12"},{default:l(()=>[e(I,{modelValue:i(h),"onUpdate:modelValue":s[3]||(s[3]=o=>S(h)?h.value=o:null),rules:[i(U)],label:"gerente"},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12"},{default:l(()=>[e(I,{modelValue:i(u),"onUpdate:modelValue":s[4]||(s[4]=o=>S(u)?u.value=o:null),type:"text",rules:[i(U)],label:"direccion"},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12"},{default:l(()=>[e(I,{modelValue:i(c),"onUpdate:modelValue":s[5]||(s[5]=o=>S(c)?c.value=o:null),type:"text",rules:[i(U)],label:"telefono"},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12"},{default:l(()=>[e(I,{modelValue:i(M),"onUpdate:modelValue":s[6]||(s[6]=o=>S(M)?M.value=o:null),type:"text",rules:[i(U)],label:"ciudad"},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12"},{default:l(()=>[e(I,{modelValue:i(k),"onUpdate:modelValue":s[7]||(s[7]=o=>S(k)?k.value=o:null),type:"text",rules:[i(U)],label:"provincia"},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12"},{default:l(()=>[e(P,{type:"submit",class:"me-3"},{default:l(()=>[O(" Crear Empresa ")]),_:1}),e(P,{type:"reset",variant:"tonal",color:"secondary",onClick:x},{default:l(()=>[O(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Me=a("span",{class:"text-5xl"},"!",-1),ze={class:"text-lg font-weight-medium"},Te={__name:"ConfirmDialogEmpresa",props:{confirmationMsg:{type:String,required:!0},idEmpresa:{type:String,required:!0},isDialogVisible:{type:Boolean,required:!0}},emits:["update:isDialogVisible","confirm"],setup(A,{emit:m}){const v=A;W(),Z();const y=j(),_=u=>{m("update:isDialogVisible",u)},w=()=>{console.log("props.idEmpresa",v.idEmpresa),m("confirm",!0),_(!1);const u={id:v.idEmpresa,userId:JSON.parse(sessionStorage.getItem("userData")).id};h(u),d(v.idEmpresa)},p=()=>{m("confirm",!1),m("update:isDialogVisible",!1)},d=u=>{y.eliminarEmpresaSeleccionada(u).then(c=>{console.log(c),setTimeout(()=>{m("empresa-creada",!0)},1e3)})},h=u=>{y.agregarEmpresaEliminadaToDB(u).then(c=>{console.log(c)})};return(u,c)=>(b(),$(ke,{"max-width":"500","model-value":v.isDialogVisible,"onUpdate:modelValue":_},{default:l(()=>[e(Q,{class:"text-center px-10 py-6"},{default:l(()=>[e(B,null,{default:l(()=>[e(P,{icon:"",variant:"outlined",color:"warning",class:"mb-4",style:{width:"88px",height:"88px","pointer-events":"none"}},{default:l(()=>[Me]),_:1}),a("h6",ze,V(v.confirmationMsg),1)]),_:1}),e(Ee,{class:"align-center justify-center gap-2"},{default:l(()=>[e(P,{variant:"elevated",onClick:w},{default:l(()=>[O(" Confirmar ")]),_:1}),e(P,{color:"secondary",variant:"tonal",onClick:p},{default:l(()=>[O(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}};const qe={style:{color:"#477130"}},Ae=a("br",null,null,-1),Fe={class:"me-3",style:{width:"80px"}},$e={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Be={style:{width:"10rem"}},Re={key:0,style:{color:"red","margin-left":"20px"}},Je=a("strong",null,"LIMITE EXCEDIDO:",-1),Le=a("a",{href:"http://www.ifluc.com",target:"_blank",rel:"noopener noreferrer"},"AQU\xCD",-1),je=a("th",{scope:"col"}," EMPRESA ",-1),Qe=a("th",{scope:"col"}," GERENTE ",-1),Ge=a("th",{scope:"col"}," RUC ",-1),He=a("th",{scope:"col"}," CIUDAD ",-1),Xe=a("th",{scope:"col"}," PROVINCIA ",-1),Ye={key:0,scope:"col"},Ke={class:"d-flex align-center"},We={key:1},Ze={class:"d-flex flex-column"},ea={class:"text-uppercase text-base"},aa={class:"text-sm text-disabled"},la={class:"text-capitalize text-base"},ta={class:"text-capitalize text-base font-weight-semibold"},sa={class:"text-base"},oa={key:0,class:"text-center",style:{width:"5rem"}},ra=a("tr",null,[a("td",{colspan:"7",class:"text-center"}," No existen empresas creadas ")],-1),na=[ra],ia={class:"text-sm text-disabled"},ua=24*60*60*1e3,al={__name:"index",setup(A){const m=j(),v=t(""),y=t(),_=t(),w=t(),p=t(10),d=t(1),h=t(1),u=t(0),c=t([]),M=JSON.parse(sessionStorage.getItem("userData")||"{}"),k=t(M?M.aplicaciones:[]),x=t(0),C=t(!1),N=t(!0),E=t([]),s=j(),o=t(0),T=t(!1);let G;try{G=JSON.parse(sessionStorage.getItem("userData")).id}catch(r){console.error("Error al obtener userData del sessionStorage:",r)}k.value&&k.value.length>0&&k.value.forEach(r=>{r.aplicacionId===4&&(x.value=r.storage)});const R=()=>{m.fetchEmpresas({q:v.value,status:w.value,plan:_.value,role:y.value,perPage:p.value,currentPage:d.value,user:JSON.parse(sessionStorage.getItem("userData")).id,origen:"ifluc"}).then(r=>{console.log(r.data.empresas),c.value=r.data.empresas,h.value=1,u.value=r.data.empresas.length,u.value<x.value?C.value=!1:(C.value=!0,N.value=!1)}).catch(r=>{console.error(r)})},le=()=>{s.fetchEmpresasEliminadasIfluc({q:v.value,status:w.value,plan:_.value,role:y.value,perPage:p.value,currentPage:d.value,user:G,origen:"ifluc"}).then(r=>{E.value=r.data.empresas,o.value=r.data.totalEmpresasEliminadasIfluc}).catch(r=>{console.error(r)})};L(R),L(()=>{d.value>h.value&&(d.value=h.value)}),L(le);const te=r=>{C.value=u.value>=x.value,T.value=!0},se=ve(()=>{const r=c.value.length?(d.value-1)*p.value+1:0,g=c.value.length+(d.value-1)*p.value;return`Mostrando ${r} a ${g} de ${u.value} registros`}),oe=r=>{m.addEmpresa(r)},J=t(!1),H=t("0"),re=r=>{J.value=!0};C.value&&(N.value=!1),x.value===1&&(N.value=!1),x.value===3&&o.value>=3&&(N.value=!1),x.value===10&&o.value>=5&&(N.value=!1);const ne=k.value.find(r=>r.aplicacionId===4).fechapago,q=new Date(ne),ie=q.getDate();let f=q.getMonth()+1<10?"0"+(q.getMonth()+1):q.getMonth()+1;const ue=q.getFullYear();switch(f){case"01":f="Enero";break;case"02":f="Febrero";break;case"03":f="Marzo";break;case"04":f="Abril";break;case"05":f="Mayo";break;case"06":f="Junio";break;case"07":f="Julio";break;case"08":f="Agosto";break;case"09":f="Septiembre";break;case"10":f="Octubre";break;case"11":f="Noviembre";break;case"12":f="Diciembre";break}const de=ie+"-"+f+"-"+ue,ce=new Date,me=Math.ceil((q-ce)/ua);return(r,g)=>(b(),z("section",null,[e(ae,null,{default:l(()=>[e(D,{cols:"12"},{default:l(()=>[e(Q,{title:"Empresas"},{subtitle:l(()=>[a("span",qe,"Usted puede crear hasta: "+V(x.value)+" empresas",1),a("p",null,[O("Su acceso a iFluc finaliza el: "+V(de)),Ae,O(" Le quedan "+V(i(me))+" d\xEDas para que renueve su licencia",1)])]),default:l(()=>[e(B,{class:"d-flex flex-wrap py-4 gap-4"},{default:l(()=>[a("div",Fe,[e(Ce,{modelValue:p.value,"onUpdate:modelValue":g[0]||(g[0]=n=>p.value=n),density:"compact",variant:"outlined",items:[10,20,30,50]},null,8,["modelValue"])]),a("div",$e,[a("div",Be,[e(I,{modelValue:v.value,"onUpdate:modelValue":g[1]||(g[1]=n=>v.value=n),placeholder:"Search",density:"compact"},null,8,["modelValue"])]),C.value?F("",!0):(b(),$(P,{key:0,"prepend-icon":"tabler-plus",onClick:te},{default:l(()=>[O(" Empresa ")]),_:1}))])]),_:1}),C.value?(b(),z("div",Re,[Je,O(" Ha superado el limite permitido de empresas, para actualizar su cuenta, click "),Le])):F("",!0),e(Y),e(Se,{class:"text-no-wrap"},{default:l(()=>[a("thead",null,[a("tr",null,[je,Qe,Ge,He,Xe,C.value?F("",!0):(b(),z("th",Ye," ACCIONES "))])]),a("tbody",null,[(b(!0),z(_e,null,ge(c.value,n=>(b(),z("tr",{key:n.id,style:{height:"3.75rem"}},[a("td",null,[a("div",Ke,[e(K,{variant:"tonal",color:"primary",class:"me-3",size:"38"},{default:l(()=>[n.avatar?(b(),$(Ie,{key:0,src:n.avatar},null,8,["src"])):(b(),z("span",We,V(i(we)(n.nombre)),1))]),_:2},1024),a("div",Ze,[a("h6",ea,V(n.nombre),1),a("span",aa,V(n.direccion),1)])])]),a("td",null,[e(K,{color:"primary",icon:"tabler-user",variant:"tonal",size:"30",class:"me-4"}),a("span",la,V(n.gerente),1)]),a("td",null,[a("span",ta,V(n.ruc),1)]),a("td",null,[a("span",sa,V(n.ciudad),1)]),a("td",null,V(n.provincia),1),N.value?(b(),z("td",oa,[e(P,{icon:"",size:"x-small",color:"default",variant:"text",onClick:ca=>{H.value=n.id,re(n.id)}},{default:l(()=>[e(ee,{size:"22",icon:"tabler-trash"})]),_:2},1032,["onClick"])])):F("",!0)]))),128))]),Ve(a("tfoot",null,na,512),[[he,!c.value.length]])]),_:1}),e(Y),e(B,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3 px-5"},{default:l(()=>[a("span",ia,V(se.value),1),e(Ne,{modelValue:d.value,"onUpdate:modelValue":g[2]||(g[2]=n=>d.value=n),size:"small","total-visible":10,length:h.value},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:1}),e(Te,{isDialogVisible:J.value,"onUpdate:isDialogVisible":g[3]||(g[3]=n=>J.value=n),"confirmation-msg":"Estas seguro de que lo que deseas es eliminar esta empresa?, al hacerlo se eliminaran todos los datos relacionados. Esta acci\xF3n no es reversible","id-empresa":H.value,onEmpresaCreada:R},null,8,["isDialogVisible","id-empresa"]),e(Pe,{isDrawerOpen:T.value,"onUpdate:isDrawerOpen":g[4]||(g[4]=n=>T.value=n),onUserData:oe,onEmpresaCreada:R},null,8,["isDrawerOpen"])]))}};export{al as default};
