import{k as u,b9 as z,j as K,r as X,o as S,c as Y,m as p,p as o,q as a,h as T,K as w,x as s,J as E,G as B,b as Q,z as b,I as W,ba as Z,y as x}from"./index.f5778ade.js";import{u as ee}from"./useAppAbility.87ee0846.js";import{a as F}from"./axios.80581068.js";import{u as M,m as ae,a as te}from"./useGenerateImageVariant.e3695adc.js";import{r as R,e as oe}from"./validators.d71d6c94.js";import{a as L,b as N}from"./auth-v2-verify-email-illustration-light.acafd95d.js";import{e as se}from"./environments.3b606d6b.js";import{b as D}from"./route-block.2f1a6263.js";import{V as re,b as le,a as ie}from"./VCard.811866d9.js";import{V as k}from"./VCardText.21459e26.js";import{V as ne}from"./VAlert.ab9ba40f.js";import{V as ue}from"./VRow.6bece164.js";import{V as P}from"./VCol.55ec6a95.js";import{d as A}from"./VTextField.04d3c35c.js";import{V as ce}from"./VCheckbox.01a187a5.js";import{V as de}from"./VBtn.1b313c05.js";import{V as me}from"./VForm.ac9a6e7e.js";import"./index.0d4b9ec4.js";import"./createSimpleFunctional.f5669897.js";import"./router.aceff5aa.js";import"./VAvatar.96e9befc.js";import"./VImg.337ce076.js";import"./position.1e434685.js";import"./location.c31d3587.js";/* empty css              */import"./index.6e84413a.js";import"./easing.36b781ab.js";import"./form.a8b2966d.js";import"./forwardRefs.c003b6b8.js";import"./VCheckboxBtn.b9d06dc9.js";import"./VSelectionControl.fb242e40.js";import"./group.e7225ded.js";const pe="/assets/logo.79795e90.png",fe=`<svg width="181" height="181" viewBox="0 0 181 181" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="1.30469" y="1.44312" width="178" height="178" rx="19" stroke="#7367F0" stroke-opacity="0.16" stroke-width="2" stroke-dasharray="8 8"/>
<rect x="22.8047" y="22.9431" width="135" height="135" rx="10" fill="#7367F0" fill-opacity="0.08"/>
</svg>
`,ge=`<svg width="239" height="234" viewBox="0 0 239 234" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="88.5605" y="0.700195" width="149" height="149" rx="19.5" stroke="#7367F0" stroke-opacity="0.16"/>
<rect x="0.621094" y="33.761" width="200" height="200" rx="10" fill="#7367F0" fill-opacity="0.08"/>
</svg>
`;const ve={class:"auth-wrapper d-flex align-center justify-center pa-4"},he={class:"position-relative my-sm-16"},Ve={class:"d-flex"},ye=p("img",{src:pe,width:"200"},null,-1),_e={class:"text-h5 text-center mb-1"},we=p("p",{class:"mb-0 text-center"}," Por favor ingresa tus credenciales ",-1),be={class:"d-flex align-center justify-space-between flex-wrap mt-2 mb-4"},xe={__name:"login",setup(ke){M(N,L,N,L,!0),M(te,ae);const h=u(!1);z();const j=K(),J=ee(),V=u({email:void 0,password:void 0}),I=u(),f=u(""),g=u(""),y=u(!1),v=u("");u([]);let r=u(!1),l=u("");const C=()=>{F.get("https://api.ipify.org/?format=json").then(i=>{const{ip:t}=i.data;v.value=t,!v.value&&retryCount<MAX_RETRIES&&(retryCount++,setTimeout(()=>C(),1e3))}).catch(i=>{console.log(i.response.data)})};C();const O=()=>{console.log("Entrando a login"),console.log("Email:",f.value),console.log("Password:",g.value),console.log("IP:",v.value),F.post(`${se.apiUrl}/token`,{email:f.value,password:g.value,aplicacion:"convertex",ip:v.value?v.value:"127.0.0.1"}).then(i=>{const{token:t,user:c,userAbilities:n,auth:q}=i.data;q?c.aplicaciones&&c.aplicaciones.length>0?c.aplicaciones.forEach(d=>{const $=d.fechapago,m=new Date($);m.getDate(),m.getMonth()+1<10?""+(m.getMonth()+1):m.getMonth()+1,m.getFullYear();const G=new Date,H=24*60*60*1e3,_=Math.ceil((m-G)/H);switch(d.aplicacionId){}d.aplicacionId===8&&_>0?(sessionStorage.setItem("userAbilities",JSON.stringify(n)),J.update(n),sessionStorage.setItem("userData",JSON.stringify(c)),sessionStorage.setItem("accessToken",JSON.stringify(t)),sessionStorage.setItem("empresasPermitidas",JSON.stringify(d.storage)),j.replace("/dashboards/analytics")):d.aplicacionId===8&&d.isActive===0?(l.value="Su usuario parece no estar activo, por favor ponerse en contacto con los administradores",r.value=!0,setTimeout(()=>{l.value="",r.value=!1},6e3)):(l.value=`Cuenta suspendida por falta de pago, p\xF3ngase en contacto con la administraci\xF3n para continuar, tiene ${d.aplicacionId===4&&_<0?_*-1+" d\xEDas con la cuenta en mora":""}`,r.value=!0,setTimeout(()=>{l.value="",r.value=!1},6e3))}):(l.value="Usted no posee aplicaci\xF3n en FacilContabilidad asociada a su usuarios, por favor ponerse en contacto con el administrador",r.value=!0,setTimeout(()=>{l.value="",r.value=!1},6e3)):(l.value="El email o la contrase\xF1a, parecen tener errores, si cree que es un error, por favor pongase en contacto con administraci\xF3n",r.value=!0,setTimeout(()=>{l.value="",r.value=!1},6e3),V.value=formErrors,console.error(e.response.data))}).catch(i=>{var c,n;const t=((n=(c=i.response)==null?void 0:c.data)==null?void 0:n.message)||"Error al iniciar sesi\xF3n";console.error("Error al hacer login:",t,i),l.value=t,r.value=!0,setTimeout(()=>{l.value="",r.value=!1},6e3)})},U=()=>{var i;(i=I.value)==null||i.validate().then(({valid:t})=>{t?(console.log(t),O()):(l.value="Por favor ingrese sus credenciales y/o h\xE1galo de manera correcta",r.value=!0,setTimeout(()=>{l.value="",r.value=!1},6e3))})};return(i,t)=>{const c=X("RouterLink");return S(),Y("div",ve,[p("div",he,[o(a(w),{nodes:a(T)("div",{innerHTML:a(ge)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),o(a(w),{nodes:a(T)("div",{innerHTML:a(fe)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),o(ie,{class:"auth-card pa-4","max-width":"448"},{default:s(()=>[o(re,{class:"justify-center"},{prepend:s(()=>[p("div",Ve,[o(a(w),{nodes:a(E).app.logo},null,8,["nodes"])])]),default:s(()=>[o(le,{class:"font-weight-bold text-h3 py-1"},{default:s(()=>[ye]),_:1})]),_:1}),o(k,{class:"pt-1"},{default:s(()=>[p("h4",_e," Bienvenidos a "+B(a(E).app.title)+" 1.0! ",1),we]),_:1}),o(k,null,{default:s(()=>[a(r)?(S(),Q(ne,{key:0,border:"start","border-color":"error"},{default:s(()=>[b(B(a(l)),1)]),_:1})):W("",!0)]),_:1}),o(k,null,{default:s(()=>[o(a(me),{ref_key:"refVForm",ref:I,onSubmit:Z(U,["prevent"])},{default:s(()=>[o(ue,null,{default:s(()=>[o(P,{cols:"12"},{default:s(()=>[o(A,{modelValue:a(f),"onUpdate:modelValue":t[0]||(t[0]=n=>x(f)?f.value=n:null),label:"Email",type:"email",rules:[a(R),a(oe)],"error-messages":a(V).email},null,8,["modelValue","rules","error-messages"])]),_:1}),o(P,{cols:"12"},{default:s(()=>[o(A,{modelValue:a(g),"onUpdate:modelValue":t[1]||(t[1]=n=>x(g)?g.value=n:null),label:"Password",rules:[a(R)],type:a(h)?"text":"password","error-messages":a(V).password,"append-inner-icon":a(h)?"tabler-eye-off":"tabler-eye","onClick:appendInner":t[2]||(t[2]=n=>h.value=!a(h))},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),p("div",be,[o(ce,{modelValue:a(y),"onUpdate:modelValue":t[3]||(t[3]=n=>x(y)?y.value=n:null),label:"Remember me"},null,8,["modelValue"]),o(c,{class:"text-primary ms-2 mb-1",to:{name:"forgot-password"}},{default:s(()=>[b(" Olvidaste tu Password? ")]),_:1})]),o(de,{block:"",type:"submit"},{default:s(()=>[b(" Login ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])}}};typeof D=="function"&&D(xe);export{xe as default};
